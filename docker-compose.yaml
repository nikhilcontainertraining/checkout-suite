version: "3.9"
services:
  mysql-con:
    container_name: mysql-con
    image: mysql
    stdin_open: true
    tty: true
    environment:
      MYSQL_ROOT_USER: root
      MYSQL_ROOT_PASSWORD: Mig5@mig5
      MYSQL_DATABASE: card_repository
    healthcheck:
      test: ["CMD","mysqladmin","ping","-h","localhost"]
    networks:
      checkout-suite-manual:
        aliases:
          - mysql-con
  payment-data-services:
    depends_on:
      mysql-con:
        condition: service_healthy
    container_name: payment-data-services
    networks:
      checkout-suite-manual:
        aliases:
          - payment-data-services
    build:
      context: ./payment-data-services
      dockerfile: Dockerfile
    working_dir: /payment-data-services
    image: nhiremathir/payment-data-services:v4
    deploy:
      restart_policy:
        max_attempts: 3
        condition: on-failure
    ports:
      - 8080:8080
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/test"]
    env_file:
      - payment-data-services/db.env
#      - ./payment-data-services/db.env_file
  checkout-orchestrator:
    depends_on:
      payment-data-services:
        condition: service_healthy
    container_name: checkout-orchestrator
    networks:
      checkout-suite-manual:
        aliases:
          - checkout-orchestrator
    build:
      context: ./checkout-orchestrator
      dockerfile: Dockerfile
    working_dir: /checkout-orchestrator
    image: nhiremathir/checkout-orchestrator:v4_m1
    volumes:
      - crypt:/checkout-orchestrator/crypt
    ports:
      - 8081:8081
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8081/test"]


networks:
  checkout-suite-manual:
    name: checkout-suite-manual


volumes:
  crypt: